!function a(o,s,u){function f(e,t){if(!s[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[e]={exports:{}};o[e][0].call(r.exports,function(t){return f(o[e][1][t]||t)},r,r.exports,a,o,s,u)}return s[e].exports}for(var h="function"==typeof require&&require,t=0;t<u.length;t++)f(u[t]);return f}({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){var e=t.options.components["k-files-section"];t.component("k-files-section",{extends:e,data:function(){return{firstLoad:!0}},watch:{data:{immediate:!1,handler:function(t,e){if(this.isLoading)return!1;if(!e.length&&this.firstLoad)return this.firstLoad=!1;var i=t.filter(function(i,t){return!e.filter(function(t,e){return t.filename==i.filename}).length});if(!i.length)return!1;FileReader&&this.findFocus(i)}}},methods:{findFocus:function(t){var i=this;t.forEach(function(f){var h=i,e=new XMLHttpRequest;e.open("get",f.url),e.responseType="blob",e.onload=function(){var t=new FileReader;t.onload=function(){var o=document.createElement("canvas"),s=o.getContext("2d"),u=new Image;u.onload=function(){var t=u.width,e=u.height;o.width=t,o.height=e,s.drawImage(u,0,0);var i=(0,c.default)(o,{debug:!1}),n=i.x/t,r=i.y/e,a='{"x":'+(n=(Math.round(100*n)/100).toFixed(2))+',"y":'+(r=(Math.round(100*r)/100).toFixed(2))+"}";h.saveFocus(f,a)},u.src=t.result},t.readAsDataURL(e.response)},e.send()})},saveFocus:function(t,e){this.$api.post("autofocus/save-focus",{uri:t.parent,filename:t.filename,coords:e}).then(function(t){}).catch(function(t){console.log(t)})}}})};var n,r=t(4),c=(n=r)&&n.__esModule?n:{default:n}},{4:4}],2:[function(t,e,i){"use strict";var n,r=t(1),a=(n=r)&&n.__esModule?n:{default:n};panel.plugin("sylvainjule/autofocus",{use:[a.default]})},{1:1}],3:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(!t)throw new TypeError("convolution matrix required");this.matrix=t,this.factor(1),this.bias(0)}Object.defineProperty(i,"__esModule",{value:!0}),(i.default=n).prototype.width=function(t){return this.w=t,this},n.prototype.height=function(t){return this.h=t,this},n.prototype.factor=function(t){return this._factor=t,this},n.prototype.bias=function(t){return this._bias=t,this},n.prototype.apply=function(t,e){for(var i=t.data,n=e.data,r=this.w,a=this.h,o=this.matrix,s=o[0].length,u=o.length,f=Math.floor(u/2),h=this._factor,c=this._bias,d=0;d<a-1;d++)for(var l=0;l<r-1;l++){for(var p=4*(d*r+l),v=0,g=0,y=0,w=0;w<s;++w)for(var m=0;m<u;++m){var _=4*((d+(w-f))*r+(l+(m-f)));v+=i[_+0]*o[w][m],g+=i[_+1]*o[w][m],y+=i[_+2]*o[w][m]}n[p+0]=h*v+c,n[p+1]=h*g+c,n[p+2]=h*y+c,n[p+3]=i[p+3]}},n.prototype.canvas=function(t){var e=t.width,i=t.height,n=t.getContext("2d"),r=n.getImageData(0,0,e,i),a=n.createImageData(e,i);this.width(e),this.height(i),this.apply(r,a),n.putImageData(a,0,0)}},{}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e){var i=(e=e||{}).debug,n=t.width,r=t.height,a=t.getContext("2d"),o=a.getImageData(0,0,n,r),s=a.createImageData(n,r);(0,f.default)([[0,-1,0],[-1,4,-1],[0,-1,0]]).width(n).height(r).apply(o,s),i&&(t.width*=2,a.putImageData(s,0,0));var u=function(t,e,i){var n=[],r=e/2,a=i/2;function o(t,e){return t=Math.abs(t-r)/r,e=Math.abs(e-a)/a,1-((t/=2)+(e/=2))}for(var s=0;s<e;++s){for(var u=0;u<i;++u){for(var f=.15*o(s+10,u+10),h=Math.min(e-s,20),c=Math.min(i-u,20),d=0,l=0;l<h;++l)for(var p=0;p<c;++p){var v=4*((u+p)*e+(s+l)),g=t[v+0],y=t[v+1],w=t[v+2],m=g+y+w,_=m/765;d+=_}f+=d/400*.85,n.push(new x.default(s,u,h,c,5*f)),u+=20}s+=20}return n}(s.data,n,r);i&&(h(u,a),a.translate(n,0),a.putImageData(o,n,0),h(u,a));return c(u).midpoint()};var f=n(t(3)),x=n(t(6));function n(t){return t&&t.__esModule?t:{default:t}}function h(t,e){for(var i=0;i<t.length;++i)t[i].draw(e);c(t).drawFocus(e)}function c(t){for(var e,i=t[0],n=1;n<t.length;++n)(e=t[n]).intensity>i.intensity&&(i=e);return i}},{3:3,6:6}],5:[function(t,e,i){"use strict";function n(t,e){this.x=t,this.y=e}Object.defineProperty(i,"__esModule",{value:!0}),(i.default=n).prototype.toString=function(){return"("+this.x+", "+this.y+")"}},{}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var n,r=t(5),a=(n=r)&&n.__esModule?n:{default:n};function o(t,e,i,n,r){this.x=t,this.y=e,this.w=i,this.h=n,this.intensity=r||0}o.prototype.midpoint=function(){return new a.default(this.x+this.w/2,this.y+this.h/2)},o.prototype.draw=function(t){var e=255*this.intensity|0,i=this.w/2*this.intensity;t.save(),t.beginPath(),t.fillStyle="rgba("+e+",0,0, .5)",t.arc(this.x+this.w/2,this.y+this.h/2,i,0,2*Math.PI,!1),t.fill(),t.restore()},o.prototype.drawFocus=function(t){var e=255*this.intensity|0,i=this.w/2*this.intensity;t.save(),t.beginPath(),t.fillStyle="rgba(0,0,"+e+", .5)",t.arc(this.x+this.w/2,this.y+this.h/2,i,0,2*Math.PI,!1),t.fill(),t.restore()}},{5:5}]},{},[2]);
